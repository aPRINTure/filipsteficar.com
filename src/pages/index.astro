---
// Components
import Layout from "@/layouts/Layout.astro";
import Polaroid from "@/components/Polaroid.astro";
import { siteData } from "@/data/global";

// Current URL
const currentURL = Astro.url.href;
// Unsplash API
const accessKey = import.meta.env.PUBLIC_UNSPLASH_ACCESS_KEY;

const response = await fetch(
    `https://api.unsplash.com/users/filipsteficar/photos?client_id=${accessKey}&per_page=40&stats=true`
);

const photos = await response.json();
// console.log(photos);

// Sort By Total Views Descending
photos.sort((a: UnsplashPhoto, b: UnsplashPhoto) => {
    const viewsA = a.statistics?.views?.total ?? 0;
    const viewsB = b.statistics?.views?.total ?? 0;
    return viewsB - viewsA;
});
// Unsplash Interface
interface UnsplashPhoto {
    statistics?: {
        views: {
            total: number;
        }
    }
    urls: {
        small: string;
        regular: string;
        full: string;
        raw: string; 
    };
    user: {
        name: string;
    }
    links: {
        html: string;
        self: string;
    }
    views: number;
    width: number;
    height: number;
}
---
<Layout 
  pageTitle={`${siteData.name} | Home`}
  pageDescription="Lorem ipsum dolor sit amet consectetur adipisicing elit. Doloremque blanditiis modi architecto ipsum. Distinctio, ipsam quis."
  currentURL={currentURL}
  ogImage="https://images.unsplash.com/photo-1677242178360-6518e2a87194?q=80&w=1170&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
  ogImageAlt="Og Image Description"
  articleAuthor={siteData.author}
>
<section class="columns-1 md:columns-2 lg:columns-3 mx-auto mt-fluid-sm px-fluid-sm container">
    {photos.map((photo: UnsplashPhoto) => (
        <div class="mb-fluid-sm break-inside-avoid">
            <Polaroid
            src={photo.urls.small}
            srcLightbox={photo.urls.regular}
            width={photo.width}
            height={photo.height}
            views={photo.statistics?.views?.total}
            author={photo.user.name}
            authorUnsplashLink={photo.links.html}
            loading="lazy"
            />
        </div>
    ))}
</section>
</Layout>